<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oficina de Fotografia com IA - CardapioGram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <div class="w-full max-w-lg mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 140" role="img" aria-label="CardápioGram logo">
                <defs>
                    <linearGradient id="instaGrad" x1="0" x2="1" y1="0" y2="1">
                    <stop offset="0" stop-color="#f58529"/>
                    <stop offset="0.3" stop-color="#dd2a7b"/>
                    <stop offset="0.6" stop-color="#8134af"/>
                    <stop offset="1" stop-color="#515bd4"/>
                    </linearGradient>
                </defs>
                
                <text x="20" y="90"
                        font-family="Poppins, Inter, Arial, Helvetica, sans-serif"
                        font-size="64"
                        font-weight="700"
                        fill="#111">
                    Cardápio
                </text>
                
                <!-- Ícone do Robô FELIZ -->
                <g transform="translate(340, 35) scale(1.2)">
                    <rect x="0" y="0" width="50" height="50" rx="10" fill="url(#instaGrad)"/>
                    <circle cx="15" cy="25" r="5" fill="white"/>
                    <circle cx="35" cy="25" r="5" fill="white"/>
                    <!-- A boca reta foi substituída por um sorriso -->
                    <path d="M 15 38 Q 25 45, 35 38" stroke="white" stroke-width="3" fill="none" stroke-linecap="round"/>
                </g>

                <text x="420" y="90"
                        font-family="Poppins, Inter, Arial, Helvetica, sans-serif"
                        font-size="64"
                        font-weight="700"
                        fill="url(#instaGrad)">
                    Gram
                </text>
                </svg>
            </div>
            <p class="text-gray-600 mt-2">Transforme fotos de celular em imagens de estúdio com o poder da IA.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
            <!-- Coluna de Controles -->
            <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl space-y-6">
                <!-- Passo 1: Upload -->
                <div>
                    <h2 class="text-xl font-bold mb-3">1. Envie sua Foto Original</h2>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 hover:bg-gray-50 transition-colors" id="drop-zone">
                        <input type="file" id="image-upload" class="hidden" accept="image/*">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                        <p class="mt-2 text-sm text-gray-600">Arraste e solte ou <span class="text-indigo-600 font-semibold">clique para selecionar</span>.</p>
                    </div>
                </div>
                
                <!-- Passo 2: Aprimoramento -->
                <div id="controls-section" class="hidden space-y-4">
                    <h2 class="text-xl font-bold mb-3 border-t pt-6">2. Descreva o Resultado Ideal</h2>
                    <div>
                        <label for="dish-description" class="block text-sm font-medium text-gray-700">Nome do Prato</label>
                        <input type="text" id="dish-description" placeholder="Ex: Hambúrguer artesanal com cheddar" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="photo-style" class="block text-sm font-medium text-gray-700">Estilo Fotográfico</label>
                        <select id="photo-style" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option>Fotografia Cinematográfica</option>
                            <option>Iluminação de Estúdio Dramática</option>
                            <option>Close-up Vívido e Apetitoso</option>
                            <option>Iluminação Natural e Suave</option>
                        </select>
                    </div>
                    <div>
                        <label for="background-style" class="block text-sm font-medium text-gray-700">Fundo</label>
                        <select id="background-style" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option>Desfocado (Bokeh)</option>
                            <option>Mesa de Madeira Rústica</option>
                            <option>Fundo de Mármore Elegante</option>
                            <option>Cor Sólida e Limpa</option>
                        </select>
                    </div>
                    <!-- Mensagem de Erro -->
                    <div id="error-message" class="hidden text-center p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
                    <button type="button" id="enhance-btn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i class="fas fa-magic-wand-sparkles mr-3"></i>Gerar Versão Profissional
                    </button>
                </div>
            </div>

            <!-- Coluna de Resultado -->
            <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl">
                <h2 class="text-xl font-bold mb-3">Resultado</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                    <div class="text-center">
                        <h3 class="font-semibold mb-2 text-sm text-gray-600">Antes</h3>
                        <div id="preview-before-container" class="w-full aspect-square bg-gray-200 rounded-lg flex items-center justify-center">
                        <i class="fas fa-camera text-5xl text-gray-400"></i>
                        <img id="preview-before" src="" class="hidden w-full h-full object-cover rounded-lg">
                        </div>
                    </div>
                    <div class="text-center">
                        <h3 class="font-semibold mb-2 text-sm text-gray-600">Depois (IA)</h3>
                        <div id="preview-after-container" class="w-full aspect-square bg-gray-200 rounded-lg flex items-center justify-center">
                        <div id="loading-spinner" class="spinner hidden"></div>
                        <i id="placeholder-icon" class="fas fa-image text-5xl text-gray-400"></i>
                        <img id="preview-after" src="" class="hidden w-full h-full object-cover rounded-lg">
                        </div>
                    </div>
                </div>
                <a href="#" id="download-btn" class="hidden mt-6 w-full text-center block bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-download mr-2"></i>Baixar Nova Foto
                </a>
                <button id="reset-btn" class="hidden mt-4 text-sm text-gray-500 hover:text-gray-800 w-full text-center">Enviar outra foto</button>
            </div>
        </main>
    </div>

    <script>
        // --- PASSO IMPORTANTE PARA USAR FORA DESTE AMBIENTE ---
        // 1. Obtenha sua chave de API gratuita no Google AI Studio: https://aistudio.google.com/
        // 2. Cole sua chave de API abaixo, substituindo a frase "SUA_CHAVE_API_VAI_AQUI".
        const apiKey = "AIzaSyCoJ5P6ZVa9lXg_r-rr3ZX9ot9tLl7_2w0"; // <<<<<<< COLE SUA CHAVE AQUI

        const dropZone = document.getElementById('drop-zone');
        const imageUpload = document.getElementById('image-upload');
        const controlsSection = document.getElementById('controls-section');
        const enhanceBtn = document.getElementById('enhance-btn');
        const resetBtn = document.getElementById('reset-btn');
        
        const previewBefore = document.getElementById('preview-before');
        const previewAfter = document.getElementById('preview-after');
        const loadingSpinner = document.getElementById('loading-spinner');
        const placeholderIcon = document.getElementById('placeholder-icon');
        const downloadBtn = document.getElementById('download-btn');
        const errorMessage = document.getElementById('error-message');
        
        let originalImageBase64 = null;

        dropZone.addEventListener('click', () => imageUpload.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-indigo-500', 'bg-gray-50'); });
        dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('border-indigo-500', 'bg-gray-50'); });
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('border-indigo-500', 'bg-gray-50'); if (e.dataTransfer.files.length) { handleFile(e.dataTransfer.files[0]); } });
        imageUpload.addEventListener('change', (e) => { if (e.target.files.length) { handleFile(e.target.files[0]); } });
        resetBtn.addEventListener('click', () => { location.reload(); });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function clearError() {
            errorMessage.classList.add('hidden');
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showError('Por favor, selecione um arquivo de imagem válido.');
                return;
            }
            clearError();
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImageBase64 = e.target.result.split(',')[1];
                previewBefore.src = e.target.result;
                previewBefore.classList.remove('hidden');
                controlsSection.classList.remove('hidden');
                resetBtn.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        enhanceBtn.addEventListener('click', async () => {
            if (apiKey === "SUA_CHAVE_API_VAI_AQUI" || apiKey === "") {
                showError("ERRO: Por favor, insira sua chave de API do Google AI Studio no código do arquivo HTML para que a aplicação funcione.");
                return;
            }

            if (!originalImageBase64) return;
            clearError();

            const dishDescription = document.getElementById('dish-description').value;
            if (!dishDescription) {
                showError("Por favor, descreva o prato para melhores resultados.");
                return;
            }
            
            placeholderIcon.classList.add('hidden');
            previewAfter.classList.add('hidden');
            downloadBtn.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            enhanceBtn.disabled = true;
            enhanceBtn.innerHTML = '<div class="spinner mx-auto" style="width: 24px; height: 24px; border-left-color: white;"></div>';

            const photoStyle = document.getElementById('photo-style').value;
            const backgroundStyle = document.getElementById('background-style').value;

            const prompt = `Use a imagem de entrada como referência principal para o prato. Recrie uma fotografia profissional de comida de um(a) ${dishDescription}, em um estilo de ${photoStyle}. O fundo deve ser ${backgroundStyle}. A imagem deve ser hiper-realista, apetitosa, com iluminação de estúdio e cores vibrantes. Foco total no prato.`;

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            {
                                inlineData: {
                                    mimeType: "image/jpeg",
                                    data: originalImageBase64
                                }
                            }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE']
                    },
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (!result.candidates || result.candidates.length === 0) {
                    let apiErrorMessage = "A API não retornou uma imagem válida.";
                    if (result.promptFeedback && result.promptFeedback.blockReason) {
                        apiErrorMessage = `A imagem foi bloqueada por segurança (${result.promptFeedback.blockReason}). Tente uma descrição ou imagem diferente.`;
                    }
                    console.error("API Response without candidates:", result);
                    throw new Error(apiErrorMessage);
                }
                
                const imagePart = result.candidates[0].content.parts.find(p => p.inlineData && p.inlineData.mimeType.startsWith('image/'));
                const base64Data = imagePart?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    previewAfter.src = imageUrl;
                    downloadBtn.href = imageUrl;
                    downloadBtn.download = `cardapiogram_foto_${dishDescription.toLowerCase().replace(/\s/g, '_')}.png`;

                    loadingSpinner.classList.add('hidden');
                    previewAfter.classList.remove('hidden');
                    downloadBtn.classList.remove('hidden');
                } else {
                    console.error("No image data found in candidate:", result.candidates[0]);
                    throw new Error("A API não retornou uma imagem válida, mesmo com uma resposta positiva.");
                }

            } catch (error) {
                console.error("Erro ao gerar imagem:", error);
                showError(error.message || "Ocorreu um erro ao gerar a imagem. Por favor, tente novamente.");
                placeholderIcon.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            } finally {
                enhanceBtn.disabled = false;
                enhanceBtn.innerHTML = '<i class="fas fa-magic-wand-sparkles mr-3"></i>Gerar Versão Profissional';
            }
        });
    </script>
</body>
</html>


